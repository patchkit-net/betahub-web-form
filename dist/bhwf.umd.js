!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e||self).betahubWebform={})}(this,function(e){function t(){return t=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},t.apply(null,arguments)}function n(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,r(e,t)}function r(e,t){return r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},r(e,t)}var i=function(e){var t=this,n=e.name,r=e.formElement,i=e.validator,o=e.onInput;this.isDisabled=!1,this.element=null,this.errorMsgElement=null,this.validator=null,this.validate=function(){var e;return null==(e=null==t.validator?void 0:t.validator(t.getValue()))||e},this.getValue=function(){return null!==t.element?t.element.value:""},this.reset=function(){null!==t.element&&(t.element.value="")};var s=r.querySelector('[data-bhwf-input="'+n+'"]'),l=r.querySelector('[data-bhwf-error-msg="'+n+'"]');this.isDisabled=null===s,this.isDisabled||(this.element=s,this.errorMsgElement=l,this.validator=i||null,o&&(null==s||s.addEventListener("input",function(e){var t;return o((null==(t=e.target)?void 0:t.value)||"")})))},o=/*#__PURE__*/function(e){function t(t){var n;return n=e.call(this,{name:"description",formElement:t,validator:function(e){var t,r=e.length>50;return!1===r&&(null==(t=n.element)||t.classList.add("bhwf-error"),n.errorMsgElement&&(n.errorMsgElement.innerText="Description must be at least 50 characters long")),r},onInput:function(){var e;null==(e=n.element)||e.classList.remove("bhwf-error"),n.errorMsgElement&&(n.errorMsgElement.innerText="")}})||this}return n(t,e),t}(i),s="https://app.betahub.io",l=function(e){var t=e.projectId,n=e.title,r=e.description,i=e.stepsToReproduce;try{var o=new URLSearchParams;return n&&o.append("issue[title]",n),o.append("issue[description]",r),i&&o.append("issue[unformatted_steps_to_reproduce]",i),Promise.resolve(fetch(s+"/projects/"+t+"/issues.json",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded",Authorization:"FormUser anonymous","BetaHub-Project-ID":t},body:o.toString()})).then(function(e){if(!e.ok)throw new Error("HTTP error! status: "+e.status);return e.json()})}catch(e){return Promise.reject(e)}},u=function(e){var t=e.projectId,n=e.issueId,r=e.screenshot;try{var i=new FormData;return i.append("screenshot[image]",r),Promise.resolve(fetch(s+"/projects/"+t+"/issues/g-"+n+"/screenshots",{method:"POST",headers:{Accept:"application/json",Authorization:"FormUser anonymous","BetaHub-Project-ID":t},body:i})).then(function(e){if(!e.ok)throw new Error("HTTP error! status: "+e.status);return e.json()})}catch(e){return Promise.reject(e)}},a=function(e){var t=e.projectId,n=e.issueId,r=e.videoClip;try{var i=new FormData;return i.append("video_clip[video]",r),Promise.resolve(fetch(s+"/projects/"+t+"/issues/g-"+n+"/video_clips",{method:"POST",headers:{Accept:"application/json",Authorization:"FormUser anonymous","BetaHub-Project-ID":t},body:i})).then(function(e){if(!e.ok)throw new Error("HTTP error! status: "+e.status);return e.json()})}catch(e){return Promise.reject(e)}},c=function(e){var t=e.projectId,n=e.issueId,r=e.logFile;try{var i=new FormData;return i.append("log_file[file]",r),Promise.resolve(fetch(s+"/projects/"+t+"/issues/g-"+n+"/log_files",{method:"POST",headers:{Accept:"application/json",Authorization:"FormUser anonymous","BetaHub-Project-ID":t},body:i})).then(function(e){if(!e.ok)throw new Error("HTTP error! status: "+e.status);return e.json()})}catch(e){return Promise.reject(e)}},f={__proto__:null,createNewIssue:l,uploadScreenshot:u,uploadVideoClip:a,uploadLogFile:c},d=/*#__PURE__*/function(e){function t(t){return e.call(this,{name:"stepsToReproduce",formElement:t})||this}return n(t,e),t}(i),h=function(e){var t=this,n=e.formElement,r=e.name,i=e.validator,o=e.onInput;this.isDisabled=!1,this.element=null,this.errorMsgElement=null,this.dropZoneElement=null,this.fileListElement=null,this.validator=null,this.validate=function(){var e;return null==(e=null==t.validator?void 0:t.validator(t.getValue()))||e},this.getValue=function(){return null!==t.element?t.element.files:null},this.reset=function(){null!==t.element&&(t.element.value=""),null!==t.fileListElement&&(t.fileListElement.innerHTML="")};var s=n.querySelector('[data-bhwf-input="'+r+'"]'),l=n.querySelector('[data-bhwf-error-msg="'+r+'"]'),u=n.querySelector('[data-bhwf-drop-zone="'+r+'"]'),a=n.querySelector('[data-bhwf-file-list="'+r+'"]');if(this.isDisabled=null===s,!this.isDisabled){this.element=s,this.errorMsgElement=l,this.dropZoneElement=u,this.fileListElement=a,this.validator=i||null,o&&(null==s||s.addEventListener("input",function(e){return o(e.target.files)}));var c=(null==u?void 0:u.innerText)||"";if(s&&u&&(s.style.display="none",u.addEventListener("dragover",function(e){e.preventDefault(),u.classList.add("bhwf-drag-over"),u.innerText="Drop here"}),u.addEventListener("dragleave",function(){u.classList.remove("bhwf-drag-over"),u.innerText=c}),u.addEventListener("drop",function(e){var t;e.preventDefault(),u.classList.remove("bhwf-drag-over");var n=(null==(t=e.dataTransfer)?void 0:t.files)||null;n&&(s.files=n,s.dispatchEvent(new Event("input")),u.innerText=c)}),u.addEventListener("click",function(){return s.click()})),a){var f=function(){if(a){a.innerHTML="";for(var e=function(e){var t=d[e],n=document.createElement("li"),r=document.createElement("img");t.type.startsWith("image/")&&(r.src=URL.createObjectURL(t),r.onload=function(){URL.revokeObjectURL(r.src)},r.classList.add("thumbnail"),n.appendChild(r));var i=document.createTextNode(t.name);n.appendChild(i);var o=document.createElement("button");o.classList.add("remove-button"),o.textContent="Remove",o.addEventListener("click",function(){d.splice(e,1),f(),l&&(l.innerText=""),u&&u.classList.remove("bhwf-error")}),n.appendChild(o),a.appendChild(n)},t=0;t<d.length;t++)e(t);var n=new DataTransfer;d.forEach(function(e){return n.items.add(e)}),s&&(s.files=n.files)}},d=[];null==s||s.addEventListener("input",function(){a.innerHTML="",null!=s&&s.files&&(d=Array.from(s.files),f())})}}},m=/*#__PURE__*/function(e){function t(t){var n;return n=e.call(this,{name:"screenshots",formElement:t,validator:function(e){if(e)for(var t=0;t<e.length;t++){var r,i;if(!e[t].type.startsWith("image/"))return null==(r=n.element)||r.classList.add("bhwf-error"),null==(i=n.dropZoneElement)||i.classList.add("bhwf-error"),n.errorMsgElement&&(n.errorMsgElement.innerText="All files must be images"),!1}return!0},onInput:function(){var e;null==(e=n.element)||e.classList.remove("bhwf-error"),n.errorMsgElement&&(n.errorMsgElement.innerText="")}})||this}return n(t,e),t}(h),v=/*#__PURE__*/function(e){function t(t){var n;return n=e.call(this,{name:"videos",formElement:t,validator:function(e){if(e)for(var t=0;t<e.length;t++){var r,i;if(!e[t].type.startsWith("video/"))return null==(r=n.element)||r.classList.add("bhwf-error"),null==(i=n.dropZoneElement)||i.classList.add("bhwf-error"),n.errorMsgElement&&(n.errorMsgElement.innerText="All files must be videos"),!1}return!0},onInput:function(){var e;null==(e=n.element)||e.classList.remove("bhwf-error"),n.errorMsgElement&&(n.errorMsgElement.innerText="")}})||this}return n(t,e),t}(h),p=/*#__PURE__*/function(e){function t(t){var n;return n=e.call(this,{name:"logs",formElement:t,validator:function(e){if(e)for(var t=0;t<e.length;t++){var r,i,o=e[t];if(o.type.startsWith("image/")||o.type.startsWith("video/"))return null==(r=n.element)||r.classList.add("bhwf-error"),null==(i=n.dropZoneElement)||i.classList.add("bhwf-error"),n.errorMsgElement&&(n.errorMsgElement.innerText="Files cannot be images or videos"),!1}return!0},onInput:function(){var e;null==(e=n.element)||e.classList.remove("bhwf-error"),n.errorMsgElement&&(n.errorMsgElement.innerText="")}})||this}return n(t,e),t}(h),b=/*#__PURE__*/function(e){function t(t){return e.call(this,{name:"media",formElement:t})||this}return n(t,e),t}(h);const g="undefined"!=typeof Symbol?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function E(e,t,n){if(!e.s){if(n instanceof w){if(!n.s)return void(n.o=E.bind(null,e,t));1&t&&(t=n.s),n=n.v}if(n&&n.then)return void n.then(E.bind(null,e,t),E.bind(null,e,2));e.s=t,e.v=n;var r=e.o;r&&r(e)}}var w=/*#__PURE__*/function(){function e(){}return e.prototype.then=function(t,n){var r=new e,i=this.s;if(i){var o=1&i?t:n;if(o){try{E(r,1,o(this.v))}catch(e){E(r,2,e)}return r}return this}return this.o=function(e){try{var i=e.v;1&e.s?E(r,1,t?t(i):i):n?E(r,1,n(i)):E(r,2,i)}catch(e){E(r,2,e)}},r},e}();function j(e){return e instanceof w&&1&e.s}function y(e,t,n){if("function"==typeof e[g]){var r,i,o,s=function(e){try{for(;!((r=l.next()).done||n&&n());)if((e=t(r.value))&&e.then){if(!j(e))return void e.then(s,o||(o=E.bind(null,i=new w,2)));e=e.v}i?E(i,1,e):i=e}catch(e){E(i||(i=new w),2,e)}},l=e[g]();if(s(),l.return){var u=function(e){try{r.done||l.return()}catch(e){}return e};if(i&&i.then)return i.then(u,function(e){throw u(e)});u()}return i}if(!("length"in e))throw new TypeError("Object is not iterable");for(var a=[],c=0;c<e.length;c++)a.push(e[c]);return function(e,t,n){var r,i,o=-1;return function s(l){try{for(;++o<e.length&&(!n||!n());)if((l=t(o))&&l.then){if(!j(l))return void l.then(s,i||(i=E.bind(null,r=new w,2)));l=l.v}r?E(r,1,l):r=l}catch(e){E(r||(r=new w),2,e)}}(),r}(a,function(e){return t(a[e])},n)}var I=/*#__PURE__*/function(){function e(e){var t=this,n=e.formElement;this.projectId=null,this.inputs={},this.fileInputs={},this.formElement=void 0,this.validate=function(){return[].concat(Object.values(t.inputs),Object.values(t.fileInputs)).reduce(function(e,t){return t.validate()&&e},!0)},this.projectId=n.getAttribute("data-bhwf-form"),this.formElement=n,this._loadDefaultInputs(),this._handleButtons()}var n=e.prototype;return n._loadDefaultInputs=function(){this.inputs={description:new o(this.formElement),stepsToReproduce:new d(this.formElement)},this.inputs=Object.fromEntries(Object.entries(this.inputs).filter(function(e){return!e[1].isDisabled})),this.fileInputs={screenshots:new m(this.formElement),videos:new v(this.formElement),logs:new p(this.formElement),media:new b(this.formElement)},this.fileInputs=Object.fromEntries(Object.entries(this.fileInputs).filter(function(e){return!e[1].isDisabled}))},n._handleButtons=function(){var e=this;this.formElement.querySelectorAll('[data-bhwf-button="submit"]').forEach(function(t){t.addEventListener("click",function(){e.validate()&&e.submit()})}),this.formElement.querySelectorAll('[data-bhwf-button="reset"]').forEach(function(t){t.addEventListener("click",function(){Object.values(e.inputs).map(function(e){return e.reset()}),Object.values(e.fileInputs).map(function(e){return e.reset()}),e.formElement.removeAttribute("data-bhwf-state")})})},n.submit=function(){try{var e,n,r,i,o,s,f=this;if(!f.projectId)return Promise.resolve();var d={description:(null==(e=f.inputs.description)?void 0:e.getValue())||void 0,stepsToReproduce:(null==(n=f.inputs.stepsToReproduce)?void 0:n.getValue())||void 0},h={screenshots:(null==(r=f.fileInputs.screenshots)?void 0:r.getValue())||void 0,videos:(null==(i=f.fileInputs.videos)?void 0:i.getValue())||void 0,logs:(null==(o=f.fileInputs.logs)?void 0:o.getValue())||void 0,media:(null==(s=f.fileInputs.media)?void 0:s.getValue())||void 0};return f.formElement.setAttribute("data-bhwf-state","loading"),Promise.resolve(function(e,n){try{var r=Promise.resolve(l(t({},d,{projectId:f.projectId}))).then(function(e){var t=e.id;function n(){function e(){function e(){function e(){f.formElement.setAttribute("data-bhwf-state","success")}var n=function(){if(h.media&&h.media.length>0)return y(h.media,function(e){var n=e.type,r=function(){if(n.startsWith("image/"))return Promise.resolve(u({projectId:f.projectId,issueId:t,screenshot:e})).then(function(){});var r=n.startsWith("video/")?Promise.resolve(a({projectId:f.projectId,issueId:t,videoClip:e})).then(function(){}):Promise.resolve(c({projectId:f.projectId,issueId:t,logFile:e})).then(function(){});return r&&r.then?r.then(function(){}):void 0}();if(r&&r.then)return r.then(function(){})})}();return n&&n.then?n.then(e):e()}var n=function(){if(h.logs&&h.logs.length>0){var e=y(h.logs,function(e){return Promise.resolve(c({projectId:f.projectId,issueId:t,logFile:e})).then(function(){})});if(e&&e.then)return e.then(function(){})}}();return n&&n.then?n.then(e):e()}var n=function(){if(h.videos&&h.videos.length>0){var e=y(h.videos,function(e){return Promise.resolve(a({projectId:f.projectId,issueId:t,videoClip:e})).then(function(){})});if(e&&e.then)return e.then(function(){})}}();return n&&n.then?n.then(e):e()}var r=function(){if(h.screenshots&&h.screenshots.length>0){var e=y(h.screenshots,function(e){return Promise.resolve(u({projectId:f.projectId,issueId:t,screenshot:e})).then(function(){})});if(e&&e.then)return e.then(function(){})}}();return r&&r.then?r.then(n):n()})}catch(e){return n()}return r&&r.then?r.then(void 0,n):r}(0,function(){f.formElement.setAttribute("data-bhwf-state","error")}))}catch(e){return Promise.reject(e)}},e}(),L=function(){document.querySelectorAll("[data-bhwf-form]").forEach(function(e){new I({formElement:e})})};window.bhwf={init:L,forms:{}},e.API=f,e.init=L});
//# sourceMappingURL=bhwf.umd.js.map
